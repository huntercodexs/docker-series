version: "3.7"
services:
    
    #----------------------------------------------------------------------------------------
    proxy:
        env_file: .env
        image: httpd:2.4.54
        container_name: proxy
        ports:
            - ${PROXY_HTTP_PORT}:80
            - ${PROXY_HTTPS_PORT}:443
        privileged: true
        volumes:
            - ./proxy/:/home/proxy/
            - ./proxy/conf/httpd.conf:/usr/local/apache2/conf/httpd.conf
            - ./proxy/conf/proxy.conf:/usr/local/apache2/conf/proxy.conf
            - ./proxy/conf/htdocs/:/usr/local/apache2/htdocs
        tty: true
        networks:
            default:
            httpd_php8_reverse_proxy_open_network:
            httpd_php8_reverse_proxy_private_network:
                ipv4_address: 10.0.0.2
    #----------------------------------------------------------------------------------------
    webserver:
        env_file: .env
        image: httpd:2.4.54
        container_name: webserver
        privileged: true
        volumes:
            - ./webserver/:/home/webserver/
            - ./webserver/conf/httpd.conf:/usr/local/apache2/conf/httpd.conf
            - ./webserver/conf/webserver.conf:/usr/local/apache2/conf/webserver.conf
            - ./webserver/conf/htdocs/:/usr/local/apache2/htdocs
            - ./applications/:/var/www/webserver/
        tty: true
        depends_on:
            - php8
        links:
            - php8
        networks:
            httpd_php8_reverse_proxy_private_network:
                ipv4_address: 10.0.0.3
    #----------------------------------------------------------------------------------------
    php8:
        env_file: .env
        container_name: php8
        build:
            context: ./php8
            dockerfile: php-8.1.0.dockerfile
        volumes:
            - ./applications/:/var/www/webserver/
        networks:
            httpd_php8_reverse_proxy_private_network:
                ipv4_address: 10.0.0.4
    #----------------------------------------------------------------------------------------

networks:
    httpd_php8_reverse_proxy_open_network:
        external: true
    httpd_php8_reverse_proxy_private_network:
        external: false
        internal: true
        driver: bridge
        ipam:
            config:
                - subnet: 10.0.0.0/16
